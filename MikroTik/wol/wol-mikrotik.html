<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial Completo: Wake-on-LAN (WOL) no MikroTik hAP ax3</title>
    <link rel="stylesheet" href="estilos.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Source+Code+Pro&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Tutorial Completo: Wake-on-LAN (WOL) no MikroTik</h1>
        <p class="subtitle">Aprenda a ligar os seus computadores remotamente usando scripts no RouterOS</p>
    </header>

    <main>
        <section id="introducao">
            <h2>1. Introdução ao Wake-on-LAN</h2>
            <p>Wake-on-LAN (WOL) é uma tecnologia que permite ligar um computador remotamente através de um sinal de rede, conhecido como "pacote mágico". Este tutorial irá guiá-lo passo a passo na configuração do seu router MikroTik (como o hAP ax3) para usar esta funcionalidade de forma eficiente através de scripts.</p>
        </section>

        <section id="pre-requisitos">
            <h2>2. Pré-requisitos Essenciais</h2>
            <p>Antes de configurar o router, o seu computador precisa estar preparado:</p>
            <ul>
                <li><strong>Ativar WOL na BIOS/UEFI:</strong> Reinicie o PC e entre na BIOS/UEFI. Procure e ative uma opção como "Wake on LAN", "Power on by PCI-E" ou similar.</li>
                <li><strong>Configurar a Placa de Rede no SO:</strong> No Windows, vá ao Gestor de Dispositivos, encontre a sua placa de rede, e nas suas propriedades, na aba "Gestão de Energia", marque as opções "Permitir que este dispositivo reative o computador" e "Apenas permitir que um pacote mágico reative o computador".</li>
                <li><strong>Obter o Endereço MAC:</strong> Anote o endereço MAC da placa de rede do(s) computador(es) que deseja ligar. Pode encontrá-lo em <code>IP > DHCP Server > Leases</code> no seu MikroTik.</li>
            </ul>
        </section>

        <section id="script-individual">
            <h2>3. Script para Ligar um Computador Específico</h2>
            <p>Esta é a base do nosso sistema. Criaremos um script robusto que serve como uma lista central e permite ligar um PC individualmente. Este script foi testado e é compatível com o RouterOS v7.12.1 e superiores.</p>

            <div class="passos">
                <h3>Passo 1: Criar o Script "Lista-WOL"</h3>
                <ol>
                    <li>Navegue até <strong>System > Scripts</strong> no WinBox ou na interface web.</li>
                    <li>Clique em <strong>Add New</strong>.</li>
                    <li>No campo <strong>Name</strong>, digite <code>Lista-WOL</code>.</li>
                    <li>No campo <strong>Source</strong>, copie e cole o código abaixo. <strong>Lembre-se de editar a lista de computadores com os seus próprios nomes e endereços MAC.</strong></li>
                </ol>
                <pre><code>
# ---------- LISTA DE COMPUTADORES (Formato Ultra-Compatível) ----------
# Adicione ou remova linhas. Formato: "NomeDoPC;XX:XX:XX:XX:XX:XX"
:local computadores {
    "pve-01;BC:D6:80:01:02:03";
    "pve-02;BC:D6:80:04:05:06";
    "Servidor-NAS;AA:BB:CC:DD:EE:FF";
    "PC-Filho;00:11:22:33:44:55"
}
# ----------------------------------------------------------------------

# Interface de rede onde os computadores estão conectados (geralmente a bridge)
:local interfaceWOL "bridge"

# Variável global para receber o nome do computador a ser ligado
:global wolTarget

:if ([:len $wolTarget] > 0) do={
    :local macToSend ""
    :foreach item in=$computadores do={
        :local currentName [:pick $item 0 [:find $item ";"]]
        :if ($currentName = $wolTarget) do={
            :set macToSend [:pick $item ([:find $item ";"] + 1) [:len $item]]
        }
    }

    :if ([:len $macToSend] > 0) do={
        :log info ("WOL: Enviando pacote para " . $wolTarget . " (" . $macToSend . ")")
        /tool wol interface=$interfaceWOL mac=$macToSend
        :put ("Pacote WOL enviado para " . $wolTarget)
    } else={
        :log error ("WOL: Computador '" . $wolTarget . "' nao encontrado na lista.")
        :put ("Erro: Computador '" . $wolTarget . "' nao encontrado na lista.")
    }
} else={
    :put "Erro: Especifique o nome do computador para ligar."
    :put "Use o comando: :global wolTarget \"nome-do-pc\"; /system script run Lista-WOL"
    :put " "
    :put "Computadores disponiveis:"
    :foreach item in=$computadores do={
        :local currentName [:pick $item 0 [:find $item ";"]]
        :put "  - $currentName"
    }
}

:set wolTarget ""
                </code></pre>
            </div>

            <div class="passos">
                <h3>Passo 2: Executar o Script</h3>
                <ol>
                    <li>Abra um <strong>New Terminal</strong>.</li>
                    <li>Para ver a lista de computadores disponíveis, execute: <code>/system script run Lista-WOL</code></li>
                    <li>Para ligar um computador específico (ex: "pve-01"), execute o comando completo numa única linha:</li>
                </ol>
                <pre><code>:global wolTarget "pve-01"; /system script run Lista-WOL</code></pre>
            </div>
        </section>

        <section id="script-todos">
            <h2>4. Script para Ligar TODOS os Computadores de Uma Vez</h2>
            <p>Para maior conveniência, podemos criar um segundo script que liga todos os computadores da sua lista com um único comando.</p>
            <div class="passos">
                <h3>Passo 1: Criar o Script "WOL-Todos"</h3>
                <ol>
                    <li>Vá novamente a <strong>System > Scripts</strong> e clique em <strong>Add New</strong>.</li>
                    <li>No campo <strong>Name</strong>, digite <code>WOL-Todos</code>.</li>
                    <li>No campo <strong>Source</strong>, cole o código abaixo. Certifique-se de que a lista de computadores aqui é uma cópia da lista no script "Lista-WOL".</li>
                </ol>
                <pre><code>
# Script para ligar TODOS os computadores da lista de uma vez

# IMPORTANTE: Mantenha esta lista exatamente igual à do seu script "Lista-WOL"
# ---------- LISTA DE COMPUTADORES (Formato Ultra-Compatível) ----------
:local computadores {
    "pve-01;BC:D6:80:01:02:03";
    "pve-02;BC:D6:80:04:05:06";
    "Servidor-NAS;AA:BB:CC:DD:EE:FF";
    "PC-Filho;00:11:22:33:44:55"
}
# ----------------------------------------------------------------------

:local interfaceWOL "bridge"

:log info "WOL-Todos: Iniciando envio de pacotes em massa."
:put "Iniciando processo para ligar todos os computadores..."
:put " "

:foreach item in=$computadores do={
    :local currentName [:pick $item 0 [:find $item ";"]]
    :local macAddress [:pick $item ([:find $item ";"] + 1) [:len $item]]

    :put ("- Enviando pacote WOL para " . $currentName . "...")
    /tool wol interface=$interfaceWOL mac=$macAddress
    :delay 1s
}

:put " "
:put "Processo finalizado!"
:log info "WOL-Todos: Todos os pacotes foram enviados."
                </code></pre>
            </div>
            <img src="Screenshot_2.png" alt="Execução bem-sucedida do script WOL-Todos no terminal MikroTik." class="terminal-img">
            <div class="passos">
                <h3>Passo 2: Executar o Script</h3>
                <ol>
                    <li>Abra um <strong>New Terminal</strong>.</li>
                    <li>Para ligar todos os computadores, execute simplesmente:</li>
                </ol>
                <pre><code>/system script run WOL-Todos</code></pre>
                 <img src="Screenshot_1.png" alt="Execução bem-sucedida do script WOL-Todos no terminal MikroTik." class="terminal-img">
                 <p class="caption">Resultado esperado no terminal após a execução do script `WOL-Todos`.</p>
            </div>
        </section>

        <section id="avancado">
            <h2>5. Tópicos Avançados (Opcional)</h2>
            <p>Para otimizar o seu sistema, considere estas melhorias.</p>
            <div class="passos">
                <h3>Centralizar a Lista de PCs</h3>
                <p>Para evitar editar a lista em dois scripts, pode fazer o `WOL-Todos` ler a lista do script `Lista-WOL`. Substitua o código do seu `WOL-Todos` por este:</p>
                <pre><code>
# Script AVANÇADO que lê a lista de outro script
:log info "WOL-Todos: Iniciando envio em massa a partir da lista central."
:put "Iniciando processo para ligar todos os computadores..."
:local scriptSource [/system script get [find name="Lista-WOL"] source]
:local listContent [:pick $scriptSource [:find $scriptSource "{"] ([:find $scriptSource "}"]+1)]
:execute (" :local computadores " . $listContent)
:local interfaceWOL "bridge"
:foreach item in=$computadores do={
    :local currentName [:pick $item 0 [:find $item ";"]]
    :local macAddress [:pick $item ([:find $item ";"] + 1) [:len $item]]
    :put ("- Enviando pacote WOL para " . $currentName . "...")
    /tool wol interface=$interfaceWOL mac=$macAddress
    :delay 1s
}
:put " "
:put "Processo finalizado!"
:log info "WOL-Todos: Todos os pacotes da lista central foram enviados."
                </code></pre>
            </div>
            <div class="passos">
                <h3>Agendar a Execução</h3>
                <p>Pode usar o Scheduler do MikroTik para ligar os seus PCs automaticamente.</p>
                <ol>
                    <li>Vá para <strong>System > Scheduler</strong>.</li>
                    <li>Crie uma nova tarefa (ex: todos os dias às 08:00).</li>
                    <li>No campo <strong>On Event</strong>, insira <code>/system script run WOL-Todos</code>.</li>
                </ol>
            </div>
        </section>

    </main>

    <footer>
        <p>Tutorial criado com base em interações e testes. Compatível com RouterOS v7.12.1.</p>
    </footer>
</body>
</html>